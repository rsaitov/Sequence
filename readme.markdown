Данный проект опубликован для демонстрации навыков разработчика.

# Задача

Требуется написать библиотеку-генератор последовательностей.

Под последовательностью понимается генерирование следующего номера согласно некому правилу. Например: последовательность простых чисел: 1,2,3,4,5... Здесь последовательность простых чисел образуется прибавлением единицы к последнему выданному числу.

Последовательность также может генерироваться по некоторому шаблону: Например, [ПРЕФИКС][ГОД][какие-то цифры0..9]. По такому правилу например могут быть созданы такие значения ABC20170001, ABC20170002, ABC20170003,...

Последовательность должна уметь хранить свое состояние в БД. Также необходимо, чтобы последовательность могла использоваться в многопользовательской среде. Чтобы не получилось так чтобы 2 пользователям библиотеки достался одинаковый номерок... Для этого особенно продумайте этот момент.

Применение готовой библиотеки, например, в механизме электронной очереди, где есть несколько компьютеров, на каждом из которых, человек пытается получить себе очередной номерок.

Использование библиотеки следующим образом. Например, для сохраненной некой последовательности всегда можно будет вызвать такой код:

``` C sharp
Sequence s = new Sequence();
if (s.Load("название последовательности")) // инициализация некоторого
генератора последовательности
{
    var str = s.Current(); // получить текущий номер последовательности
    var next = s.NextValue(); // получить следующий номер последовательности
}
```

В многопоточной, многопользовательской среде он должен всегда отрабавываться корректно.

Итоговым результатом должен быть многопоточный тест (где, например, 10 параллельных потоков, где каждый поток пытается получить очередной номерок). Все потоки должны получить номерки правильно и БД при этом не встала из-за дэдлоков.

# Решение

Решение содержит 3 проекта:

Sequence - библиотека с последовательностями;
Sequence.Tests - набор тестов;
MainProgram - пример клиентского использования.
В библиотеке содержится 2 класса последовательностей:

LocalSequence - однопользовательская многопоточная последовательность;
ContextSequence - многопользовательская многопоточная последовательность, хранящая состояние в БД.
Формат последовательность задаётся в конструкторе. Поддерживаемые составляющие:

* [любой текст] - фиксированная строка;
* [year] - текущий год;
* [0000] - итератор, ограниченный количеством символов в числе.
В конструкторе производится проверка формата на наличие и уникальность итератора.

Пример:

``` C sharp
_sequence = new LocalSequence("[00]"); \\формат возвращаемых значений 01, 02, 03...
_sequence = new LocalSequence("[ABC_][0000][_][year]"); \\формат возвращаемых значений ABC_0001_2018, ABC_0002_2018, ABC_0003_2018...
_sequence = new LocalSequence("[ABC][year]"); \\Exception с текстом 'Формат последовательности не содержит итератора'
_sequence = new LocalSequence("[000][ABC][000]"); \\Формат последовательности содержит больше одного итератора'
```

При достижении итератором максимального значения, ограниченного количеством символов в числе выбрасывается Exception с поясняющим сообщением.

В качестве БД может выступать любой класс, реализующий интерфейс IDbSet. В данном примере в качестве БД используется обычный текстовый файл db.txt, располагающийся в текущей директории исполняемого файла. Путь к нему указывается при создании экземпляра последовательности ContextSequence.

# Рефакторинг

Дальнейший рефакторинг возможен и заключается в:

* [ContextSequence] Уменьшении связности классов BaseSequence и FileSet. Для проверки наращивания итератора контроллер БД обращается к методу последовательности.
* [ContextSequence] Реализация метода Current() для изъятия текущего тикета последовательности из БД.
* [FileSet] Рефакторинг методов SetSequenceIfNotExists(), NextValue(). Удаление дубликатов кода.
